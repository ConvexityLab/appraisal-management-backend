{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {
      "value": "eastus"
    },
    "environment": {
      "value": "prod"
    },
    "appName": {
      "value": "appraisal-mgmt"
    },
    "organizationPrefix": {
      "value": "contoso"
    },
    "resourceGroupNamingPattern": {
      "value": "rg-{appName}-{environment}-{location}"
    },
    "resourceNamingPattern": {
      "value": "{appName}-{environment}"
    },
    "customResourceGroupName": {
      "value": ""
    },
    "tags": {
      "value": {
        "Environment": "Production",
        "Application": "Appraisal Management",
        "ManagedBy": "Bicep",
        "DeployedBy": "Azure DevOps",
        "CostCenter": "IT",
        "Owner": "Platform Team"
      }
    },
    "appServicePlanSkus": {
      "value": {
        "dev": {
          "name": "B1",
          "capacity": 1
        },
        "staging": {
          "name": "S2", 
          "capacity": 1
        },
        "prod": {
          "name": "P2v3",
          "capacity": 3
        }
      }
    },
    "nodeVersion": {
      "value": "20-lts"
    },
    "enableAutoScaling": {
      "value": true
    },
    "autoScalingConfig": {
      "value": {
        "minCapacity": 3,
        "maxCapacity": 20,
        "defaultCapacity": 3,
        "scaleOutThreshold": 70,
        "scaleInThreshold": 30,
        "scaleOutCooldown": "PT3M",
        "scaleInCooldown": "PT8M"
      }
    },
    "cosmosDatabaseName": {
      "value": "appraisal-production"
    },
    "cosmosDbConfigs": {
      "value": {
        "dev": {
          "tier": "serverless",
          "enableAutomaticFailover": false,
          "enableMultipleWriteLocations": false,
          "defaultConsistencyLevel": "Session",
          "backupStorageRedundancy": "Local"
        },
        "staging": {
          "tier": "provisioned",
          "throughput": 800,
          "enableAutomaticFailover": true,
          "enableMultipleWriteLocations": false,
          "defaultConsistencyLevel": "Session",
          "backupStorageRedundancy": "Zone"
        },
        "prod": {
          "tier": "provisioned", 
          "throughput": 2000,
          "enableAutomaticFailover": true,
          "enableMultipleWriteLocations": true,
          "defaultConsistencyLevel": "BoundedStaleness",
          "backupStorageRedundancy": "Geo"
        }
      }
    },
    "cosmosSecondaryRegion": {
      "value": "westus2"
    },
    "cosmosContainers": {
      "value": [
        {
          "name": "orders",
          "partitionKeyPath": "/clientId",
          "uniqueKeyPaths": [
            {
              "paths": ["/orderId"]
            }
          ],
          "defaultTtl": -1
        },
        {
          "name": "properties",
          "partitionKeyPath": "/address/zipCode", 
          "uniqueKeyPaths": [],
          "defaultTtl": -1,
          "spatialIndexes": [
            {
              "path": "/location/*",
              "types": ["Point", "Polygon"]
            }
          ]
        },
        {
          "name": "vendors",
          "partitionKeyPath": "/businessInfo/primaryServiceArea",
          "uniqueKeyPaths": [],
          "defaultTtl": -1
        },
        {
          "name": "users",
          "partitionKeyPath": "/organizationId",
          "uniqueKeyPaths": [
            {
              "paths": ["/email"]
            }
          ],
          "defaultTtl": -1,
          "excludedPaths": ["/password/?", "/refreshTokens/*"]
        },
        {
          "name": "audit-events",
          "partitionKeyPath": "/aggregateId",
          "uniqueKeyPaths": [],
          "defaultTtl": 7776000
        }
      ]
    },
    "backupConfig": {
      "value": {
        "intervalInMinutes": 120,
        "retentionIntervalInHours": 24
      }
    },
    "keyVaultSku": {
      "value": "premium"
    },
    "keyVaultRetention": {
      "value": {
        "dev": {
          "softDeleteRetention": 7,
          "diagnosticRetention": 30
        },
        "staging": {
          "softDeleteRetention": 30,
          "diagnosticRetention": 90  
        },
        "prod": {
          "softDeleteRetention": 90,
          "diagnosticRetention": 730
        }
      }
    },
    "enablePurgeProtection": {
      "value": true
    },
    "serviceBusSkus": {
      "value": {
        "dev": "Basic",
        "staging": "Standard", 
        "prod": "Premium"
      }
    },
    "serviceBusConfig": {
      "value": {
        "queues": [
          "order-processing",
          "property-analysis", 
          "vendor-notifications",
          "document-processing"
        ],
        "topics": [
          "appraisal-events",
          "system-notifications",
          "audit-logs"
        ]
      }
    },
    "storageSkus": {
      "value": {
        "dev": "Standard_LRS",
        "staging": "Standard_ZRS",
        "prod": "Standard_GZRS"
      }
    },
    "storageContainers": {
      "value": [
        "documents",
        "images", 
        "reports",
        "backups",
        "templates"
      ]
    },
    "logRetentionDays": {
      "value": {
        "dev": 30,
        "staging": 90,
        "prod": 730
      }
    },
    "appInsightsDataCap": {
      "value": {
        "dev": 2,
        "staging": 10,
        "prod": 50
      }
    }
  }
}